"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var l=t[r];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(t,r,l){return r&&e(t.prototype,r),l&&e(t,l),t}}(),BoardManager=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"tryGetCell",value:function(e,t,r){return this.isValidMove(e,t)?r.rows[e][t]:null}},{key:"isValidMove",value:function(e,t){return e>-1&&t>-1&&8>e&&8>t}},{key:"getFlatGameBoard",value:function(e){return Array.prototype.concat.apply([],e.rows)}},{key:"getEmptyCells",value:function(e){return this.getFlatGameBoard(e).filter(function(e){return 0===e.player})}},{key:"getPlayerCells",value:function(e,t){return this.getFlatGameBoard(t).filter(function(t){return t.player===e})}},{key:"getAdjacentCells",value:function(e,t){var r=this.tryGetCell(e.row-1,e.col,t),l=this.tryGetCell(e.row-1,e.col+1,t),n=this.tryGetCell(e.row-1,e.col-1,t),a=this.tryGetCell(e.row,e.col-1,t),i=this.tryGetCell(e.row,e.col+1,t),o=this.tryGetCell(e.row+1,e.col,t),u=this.tryGetCell(e.row+1,e.col+1,t),c=this.tryGetCell(e.row+1,e.col-1,t);return[r,l,n,a,i,o,u,c].filter(function(e){return null!==e})}},{key:"getOpenAdjacentCells",value:function(e,t){return this.getAdjacentCells(e,t).filter(function(e){return 0===e.player})}},{key:"resetTargetCells",value:function(e){this.getFlatGameBoard(e).forEach(function(e){return e.isTarget=!1})}},{key:"getiInitialPlayer",value:function(e,t){return 3===e&&3===t||4===e&&4===t?1:3===e&&4===t||4===e&&3===t?2:0}},{key:"cellIsInitialTarget",value:function(e,t){return 2===e&&4===t||3===e&&5===t||4===e&&2===t||5===e&&3===t}},{key:"getInitialGameboard",value:function(){for(var e=new Gameboard,t=0;8>t;t++){for(var r=[],l=0;8>l;l++)r.push(new Cell(t,l,this.getiInitialPlayer(t,l),this.cellIsInitialTarget(t,l)));e.rows.push(r)}return e}}]),e}();
"use strict";function _classCallCheck(s,t){if(!(s instanceof t))throw new TypeError("Cannot call a class as a function")}var Cell=function s(t,a,i,c){_classCallCheck(this,s),this.row=t,this.col=a,this.player=i,this.isTarget=c,this.distance=0};
"use strict";function _classCallCheck(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")}var Gameboard=function s(a){_classCallCheck(this,s),this.rows=[],this.moves=[],this.players=a};
"use strict";function _classCallCheck(s,i){if(!(s instanceof i))throw new TypeError("Cannot call a class as a function")}var Move=function s(i,t,a,c,n){_classCallCheck(this,s),this.col=t,this.row=i,this.pointValue=a,this.player=c,this.isHighestScoring=n||!1};
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,r,t){return r&&e(n.prototype,r),t&&e(n,t),n}}(),Observable=function(){function e(){_classCallCheck(this,e),this.observers=[]}return _createClass(e,[{key:"subscribe",value:function(e){this.observers.push(e)}},{key:"notify",value:function(e){this.observers.forEach(function(n){return n(e)})}}]),e}();
"use strict";function _classCallCheck(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")}var Player=function s(a){_classCallCheck(this,s),this.number=a,this.score=2,this.moves=[]};
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),Repository=function(){function e(){_classCallCheck(this,e),this.snapshots=[]}return _createClass(e,[{key:"recordMove",value:function(e){var t=this.getSnapshotPattern(e.gameBoard);console.log("Snapshot created: ",t),this.snapshots.push(t),e.snapShots=this.snapshots,console.log("Saving Data: ",e)}},{key:"getSnapshotPattern",value:function(e){return e.moves.reduce(function(e,t){return e+(t.col+"-"+t.row+"-"+t.player+"-"+(+t.wasHighestScoring||0)+",")},"")}}]),e}();
"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(r,t,a){return t&&e(r.prototype,t),a&&e(r,a),r}}(),ScoreKeeper=function(){function e(r){_classCallCheck(this,e),this.boardManager=r}return _createClass(e,[{key:"setScoreForMove",value:function(e,r,t,a){for(var n=[],o=-1;1>=o;o++)for(var i=-1;1>=i;i++)(0!==o||0!==i)&&(n=n.concat(this.searchAt(e,r,o,i,t,a)));return n}},{key:"recordMove",value:function(e,r,t,a){var n=this,o=this.setScoreForMove(e,r,t,a),i=new Move(e,r,o.length,t);return o.length&&(a.moves.push(i),a.rows[e][r].player=t,o.forEach(function(e){e.distance=n.getHitDistance(i,e.col,e.row),e.player=t,e.isHit=!0})),o}},{key:"getHitDistance",value:function(e,r,t){var a=Math.abs(t-e.row),n=Math.abs(r-e.col);return n||a}},{key:"calculatePoints",value:function(e,r,t,a,n){function o(e,o){for(var l=!0;l;){var s=e,u=o;f=v=void 0,l=!1;var f=c.boardManager.tryGetCell(s,u,n);if(null===f)return[];var v=c.checkCell(f,a);if(!v.isValidMove||v.isEmpty)return[];if(!v.isPoint)return i;i.push(f),e=s+r,o=u+t,l=!0}}var i=[],c=this;return o(e.row,e.col)}},{key:"checkCell",value:function(e,r){var t=this.boardManager.isValidMove(e.row,e.col),a=t?0===e.player:!1,n=t?e.player!==r&&!a:!1;return{isValidMove:t,isEmpty:a,isPoint:n}}},{key:"getScoreForPlayer",value:function(e,r){return this.boardManager.getFlatGameBoard(r).reduce(function(r,t){return t.player===e&&r++,r},0)}},{key:"getLeader",value:function(e,r){return e.score>r.score?1:r.score>e.score?2:0}},{key:"resetMoveScoreRatings",value:function(e){return this.boardManager.getFlatGameBoard(e).forEach(function(e){e.isHighestScoring=!1,e.isHit=!1,e.distance=0}),e}},{key:"searchAt",value:function(e,r,t,a,n,o){var i=this.boardManager.tryGetCell(e+t,r+a,o);return null!==i?this.calculatePoints(i,t,a,n,o):[]}},{key:"setPlayerScores",value:function(e,r){var t=this;e.forEach(function(e){return e.score=t.getScoreForPlayer(e.number,r)})}},{key:"nextMovesForPlayer",value:function(e,r){var t=this,a=[],n=0,o=1===e?2:1,i={rows:r.rows.slice(0)};return t.boardManager.resetTargetCells(i),t.boardManager.getPlayerCells(o,i).forEach(function(r){t.boardManager.getOpenAdjacentCells(r,i).forEach(function(r){var o=t.setScoreForMove(r.row,r.col,e,i).length;n=n>o?n:o,o&&(r.isTarget=!0,r.pointValue=o,a.push(r))})}),a.forEach(function(e){return e.isHighestScoring=e.pointValue===n}),a}}]),e}();
"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,a){for(var n=0;n<a.length;n++){var t=a[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(a,n,t){return n&&e(a.prototype,n),t&&e(a,t),a}}(),View=function(){function e(){_classCallCheck(this,e);var a=this;this.onMove=new Observable,this.loggingEnabled=!1,$(function(){var e=$(".shell");$(".game-board").on("click",".cell",function(){var e=$(this),n=e.data("target");if(n){var t=+e.data("row-num"),o=+e.data("col-num");a.onMove.notify({row:t,col:o})}}),$(".demo-toolbar").on("change",".show-move-marks",function(){this.checked?e.addClass("show-marks"):e.removeClass("show-marks")}).on("change",".show-logging",function(){a.loggingEnabled=this.checked,this.checked?e.addClass("show-logging"):e.removeClass("show-logging")})})}return _createClass(e,[{key:"markInitialPlayerPieces",value:function(e){}},{key:"renderGameBoard",value:function(e,a){var n="";e.rows.forEach(function(e){e.forEach(function(e){var a=e.player?"<div class='player-game-piece'></div>":"";n+="<div class='cell'\n                              title='row: "+e.row+" col: "+e.col+" distance: "+e.distance+" isTarget: "+e.isTarget+"'\n                              data-target=\""+e.isTarget+'"\n                              data-distance="'+e.distance+'"\n                              data-is-highest-scoring-move="'+e.isHighestScoring+'"\n                              data-player-num="'+e.player+"\"\n                              data-row-num='"+e.row+"'\n                              data-col-num='"+e.col+"'>"+a+"</div>"})}),$(".game-board").html(n),a.map(function(e){return e.distance}).filter(function(e,a,n){return n.indexOf(e)===a}).sort(function(e,a){return e-a}).forEach(function(e,a){setTimeout(function(){$("[data-distance='"+e+"'] .player-game-piece").addClass("animated-fast pulse")},75*a)})}},{key:"updateScoreBoards",value:function(e,a){e.forEach(function(e){var n=$(".player-"+e.number);$(".player-"+e.number+" .score").html(e.score),$(".player-"+e.number+" .moves").html(e.moves.length),e.number===a?n.addClass("active"):n.removeClass("active")})}},{key:"announceWinner",value:function(e){$(".score-board.player-"+e).addClass("active animated tada")}},{key:"updateLogging",value:function(e){if(this.loggingEnabled){var a=$(".logging-container");a.append(e),a.animate({scrollTop:a.prop("scrollHeight")},2e3)}}}]),e}();
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),Othello=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"sortMovesByPointValue",value:function(e){return e.map(function(e){return e}).sort(function(e,n){return n.pointValue-e.pointValue})}},{key:"isCorner",value:function(e){var n=[[0,0],[0,7],[7,0],[7,7]];return n.some(function(n){return n[0]===e.col&&n[1]===e.row})}},{key:"isEdge",value:function(e){return 0===e.row||7===e.row||0===e.col||7===e.col}},{key:"getHighestScoringMove",value:function(e){return this.sortMovesByPointValue(e)[0]}},{key:"makeMove",value:function(e){var n=this,t=e.filter(function(e){return n.isCorner(e)}),r=e.filter(function(e){return n.isEdge(e)}),o={};return o=t.length?this.getHighestScoringMove(t):r.length?this.getHighestScoringMove(r):this.getHighestScoringMove(e),{row:o.row,col:o.col}}}]),e}();
"use strict";!function(){var e=new Player(1),n=new Player(2),r=e,o=n,a=[e,n],l=new BoardManager,t=l.getInitialGameboard(),i=new ScoreKeeper(l),s=new Othello,u=new View,c={singlePlayer:0,twoPlayer:1,learning:2},g=c.learning,m=function w(l){var c=i.recordMove(l.row,l.col,r.number,t),m=c.length;m&&!function(){var l=i.nextMovesForPlayer(o.number,t);i.setPlayerScores(a,t),u.renderGameBoard(t,c),i.resetMoveScoreRatings(t),l.length?(console.log("It's now player "+o.number+"'s turn"),v(g,o)&&(u.updateLogging("Othello is thinking..."),setTimeout(function(){var e=s.makeMove(l);u.updateLogging("<p>Othello is making move at row:"+e.row+", col:"+e.col+"</p>"),w(e)},2e3)),d(r.number)):!function(){var a=i.nextMovesForPlayer(r.number,t);if(u.renderGameBoard(t,c),a.length)console.log("It's still player "+r.number+"'s turn"),v(g,o)&&setTimeout(function(){var e=s.makeMove(a);console.log("Othello is making move at row:"+e.row+", col:"+e.col),w(e)},1e3);else{var l=i.getLeader(e,n);l?(console.log("Game Over! Our winner is player "+l),u.announceWinner(l)):console.log("Game Over! We have a tie!")}}(),u.updateScoreBoards(a,r.number)}()},v=function(e,n){return e===c.learning||e===c.singlePlayer&&2===n.number},d=function(a){1===a?(r=n,o=e):(r=e,o=n)};u.onMove.subscribe(m),u.renderGameBoard(t,[]),u.updateScoreBoards(a,r.number)}();
//# sourceMappingURL=app.js.map
